"use strict";

var info = "http://www.omdbapi.com/?t=";
var title = $('.movie').val();
var url = info + title;
var FIREBASE_URL = "https://flickpicker.firebaseio.com/flicks.json";
var FIREBASE_AUTH = 'https://flickpicker.firebaseio.com';
var fb = new Firebase(FIREBASE_AUTH);
var scoreArr = [];

//taste test button works.
$('.tasteTest').on('click', function () {
  var scoreTotalArr = scoreArr.split(" ").map(Number);
  var $ttResult = $(".rating");
  var total = scoreTotalArr.reduce(function (prev, curr) {
    return prev + curr;
  });
  if (total >= 45) {
    addTasteTestResult(total);
    $ttResult.append('<img src="http://upload.wikimedia.org/wikipedia/en/thumb/2/2d/Certified_Fresh.svg/150px-Certified_Fresh.svg.png"</img>');
    //alert("Hey, you know good film when you see it!  You should put down your friends opinions about movies now because your opinions are better and have been reaffirmed by me.  Got it?")
  } else if (total >= 40) {
      alert("Alright, you like good movies but have some guilty pleasures.  Its ok.  I like Mean Girls too.");
    } else if (total >= 35) {
      alert("Sometimes I wonder if we mean the same thing by 'good'...");
    } else if (total >= 30) {
      alert("Step your game up.  Might I recommend starting with 'Goodfellas or The Departed?'");
    } else if (total < 30) {
      alert("You probably talk and text in theaters and definitely dont deserve a Netflix account.");
    };
});

//appending taste test result to page
function addTasteTestResult(total) {
  var $removeBtn = $('.remove');
  var $ttResult = $(".rating");
  $removeBtn.removeClass('hidden');
  $ttResult.append("Taste Test Score: ", total);
  $ttResult.removeClass('hidden');
}

// //trying to get the taste test result to hide on button click
$('.remove').on('click', function () {
  var $ttResult = $(".rating");
  var $removeBtn = $('.remove');
  $removeBtn.addClass('hidden');
  $ttResult.addClass("hidden");
  $ttResult.empty('.rating');
});

//on page load it checks if you are logged in.  If you arent, it sends you to login page.
$(document).ready(function () {
  if (window.location.pathname !== '/login.html' && !fb.getAuth()) {
    window.location = '/login.html';
  }
});

//search button working and done
$('.search').on('click', function () {
  var input = document.querySelector("#movieName");
  var title = input.value;
  var url = info + title;
  var uid = fb.getAuth().uid;
  var token = fb.getAuth().token;
  var postUrl = FIREBASE_AUTH + "/users/" + uid + "/flicks.json?auth=" + token;
  $.get(url, function (data) {
    console.log(data);
    if (data.Response === "True") {
      $.post(postUrl, JSON.stringify(data), function (res) {
        console.log("Post Request Passed");
      });
      addMovieDetail(data);
    } else {
      alert("Sorry! Film not found! Check title and try again!");
    }
  }, 'jsonp');
});

//loads data per user and keeps its persisting
$(document).ready(function () {
  if (window.location.pathname === '/' && fb.getAuth() !== null) {
    var uid = fb.getAuth().uid;
    var token = fb.getAuth().token;
    var MovieListUrl = FIREBASE_AUTH + "/users/" + uid + "/flicks.json?auth=" + token;
    $.get(MovieListUrl, function (movies) {
      Object.keys(movies).forEach(function (id) {
        addMovieDetail(movies[id], id);
      });
    });
  }
});

function addMovieDetail(data, id) {
  var $table = $(".table");
  $table.append("<tr></tr>");
  var $target = $("tr:last");
  scoreArr = scoreArr + Math.round(data.imdbRating) + " ";
  $target.attr("data-id", id);
  $target.append("<td>" + data.Title + "</td>");
  $target.append("<td>" + data.imdbRating + "</td>");
  $target.append("<td>" + data.Released + "</td>");
  $target.append("<td><img width='200' height='250' src=" + data.Poster + "></img></td>");
  $target.append("<button class='delete'>Delete</button>");
};

///Deletes individual users data from firebase
var $button = $('.table');
$button.on("click", ".delete", function () {
  var uid = fb.getAuth().uid;
  var token = fb.getAuth().token;
  var $movieRow = $(this).closest('tr');
  var id = $movieRow.attr('data-id');
  var deleteUrl = FIREBASE_AUTH + '/' + 'users' + '/' + uid + '/' + 'flicks' + '/' + id + '.json';
  $.ajax({
    url: deleteUrl,
    type: 'DELETE',
    success: function success() {
      $movieRow.remove();
    }
  });
});

//everything below this point is for login.html

//login button
$('.loginPageForm form').on('submit', function (evt) {
  var email = $('.loginPageForm input[type="email"]').val();
  var password = $('.loginPageForm input[type="password"]').val();
  var onTempPassword = $('.onTempPassword');
  evt.preventDefault();
  fb.authWithPassword({
    email: email,
    password: password
  }, function (err, authData) {
    if (err) {
      alert(err.toString());
    } else if (authData && authData.password.isTemporaryPassword) {
      onTempPassword.removeClass('hidden');
      alert("Please change your password now.");
    } else {
      window.location = '/';
    }
  });
});

// runs when called by registration button if  successful
function doLogin(email, password, cb) {
  fb.authWithPassword({
    email: email,
    password: password
  }, function (err, authData) {
    if (err) {
      alert(err.toString());
    } else {
      saveAuthData(authData);
      typeof cb === 'function' && cb(authData);
      window.location = '/';
      alert("Registration Successful!");
    }
  });
}

//saves the authentication data to firebase
function saveAuthData(authData) {
  $.ajax({
    method: 'PUT',
    url: FIREBASE_AUTH + "/users/" + authData.uid + "/profile.json",
    data: JSON.stringify(authData)
  });
}

//register button
$('.loginPageForm .doRegister').click(function () {
  var email = $('.loginPageForm input[type="email"]').val();
  var password = $('.loginPageForm input[type="password"]').val();

  fb.createUser({
    email: email,
    password: password
  }, function (err, userData) {
    if (err) {
      alert(err.toString());
    } else {
      doLogin(email, password);
    }
  });
  event.preventDefault();
});

//forgot password button
$('.loginPageForm .doResetPassword').click(function () {
  var email = $('.loginPageForm input[type="email"]').val();

  fb.resetPassword({
    email: email
  }, function (err) {
    if (err) {
      alert(err.toString());
    } else {
      alert('Check your email!');
    }
  });
});

//reset password form
$('.onTempPassword form').submit(function () {
  var email = fb.getAuth().password.email;
  var oldPw = $('.onTempPassword input:nth-child(1)').val();
  var newPw = $('.onTempPassword input:nth-child(2)').val();

  fb.changePassword({
    email: email,
    oldPassword: oldPw,
    newPassword: newPw
  }, function (err) {
    if (err) {
      alert(err.toString());
    } else {
      fb.unauth();
    }
  });

  event.preventDefault();
});

//reset password button
$('.onTempPassword form').submit(function () {
  var email = fb.getAuth().password.email;
  var oldPw = $('.onTempPassword input:nth-child(1)').val();
  var newPw = $('.onTempPassword input:nth-child(2)').val();

  fb.changePassword({
    email: email,
    oldPassword: oldPw,
    newPassword: newPw
  }, function (err) {
    if (err) {
      alert(err.toString());
    } else {
      fb.unauth();
      window.location = '/';
    }
  });

  event.preventDefault();
});

//logout button
$('.logout').on('click', function () {
  fb.unauth();
  window.location = '/';
});
//# sourceMappingURL=data:application/json;base64,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YyxDQUFDO0FBQ2hCLFNBQUssRUFBRSxLQUFLO0FBQ1osZUFBVyxFQUFFLEtBQUs7QUFDbEIsZUFBVyxFQUFFLEtBQUs7R0FDbkIsRUFBRSxVQUFTLEdBQUcsRUFBRTtBQUNmLFFBQUksR0FBRyxFQUFFO0FBQ1AsV0FBSyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0tBQ3ZCLE1BQU07QUFDTCxRQUFFLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDWixZQUFNLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQTtLQUN0QjtHQUNGLENBQUMsQ0FBQzs7QUFFSCxPQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7Q0FDeEIsQ0FBQyxDQUFBOzs7QUFHRixDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxZQUFXO0FBQ2xDLElBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNaLFFBQU0sQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFBO0NBQ3RCLENBQUMsQ0FBQyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGluZm8gPSBcImh0dHA6Ly93d3cub21kYmFwaS5jb20vP3Q9XCI7XG52YXIgdGl0bGUgPSAkKCcubW92aWUnKS52YWwoKTtcbnZhciB1cmwgPSBpbmZvICsgdGl0bGU7XG52YXIgRklSRUJBU0VfVVJMID0gXCJodHRwczovL2ZsaWNrcGlja2VyLmZpcmViYXNlaW8uY29tL2ZsaWNrcy5qc29uXCJcbnZhciBGSVJFQkFTRV9BVVRIID0gJ2h0dHBzOi8vZmxpY2twaWNrZXIuZmlyZWJhc2Vpby5jb20nO1xudmFyIGZiID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFX0FVVEgpO1xudmFyIHNjb3JlQXJyID0gW107XG5cblxuLy90YXN0ZSB0ZXN0IGJ1dHRvbiB3b3Jrcy5cbiQoJy50YXN0ZVRlc3QnKS5vbignY2xpY2snLCBmdW5jdGlvbigpe1xuICB2YXIgc2NvcmVUb3RhbEFyciA9IHNjb3JlQXJyLnNwbGl0KFwiIFwiKS5tYXAoTnVtYmVyKTtcbiAgdmFyICR0dFJlc3VsdD0kKFwiLnJhdGluZ1wiKTtcbiAgdmFyIHRvdGFsID0gc2NvcmVUb3RhbEFyci5yZWR1Y2UoZnVuY3Rpb24ocHJldiwgY3Vycikge1xuICByZXR1cm4gcHJldiArIGN1cnI7XG59KTtcbmlmICh0b3RhbCA+PSA0NSkge1xuICBhZGRUYXN0ZVRlc3RSZXN1bHQodG90YWwpO1xuICAkdHRSZXN1bHQuYXBwZW5kKCc8aW1nIHNyYz1cImh0dHA6Ly91cGxvYWQud2lraW1lZGlhLm9yZy93aWtpcGVkaWEvZW4vdGh1bWIvMi8yZC9DZXJ0aWZpZWRfRnJlc2guc3ZnLzE1MHB4LUNlcnRpZmllZF9GcmVzaC5zdmcucG5nXCI8L2ltZz4nKVxuICAgIC8vYWxlcnQoXCJIZXksIHlvdSBrbm93IGdvb2QgZmlsbSB3aGVuIHlvdSBzZWUgaXQhICBZb3Ugc2hvdWxkIHB1dCBkb3duIHlvdXIgZnJpZW5kcyBvcGluaW9ucyBhYm91dCBtb3ZpZXMgbm93IGJlY2F1c2UgeW91ciBvcGluaW9ucyBhcmUgYmV0dGVyIGFuZCBoYXZlIGJlZW4gcmVhZmZpcm1lZCBieSBtZS4gIEdvdCBpdD9cIilcbiAgfSBlbHNlIGlmICh0b3RhbCA+PSA0MCkge1xuICAgIGFsZXJ0KFwiQWxyaWdodCwgeW91IGxpa2UgZ29vZCBtb3ZpZXMgYnV0IGhhdmUgc29tZSBndWlsdHkgcGxlYXN1cmVzLiAgSXRzIG9rLiAgSSBsaWtlIE1lYW4gR2lybHMgdG9vLlwiKVxuICAgIH1cbiAgICBlbHNlIGlmICh0b3RhbCA+PSAzNSkge1xuICAgICAgYWxlcnQoXCJTb21ldGltZXMgSSB3b25kZXIgaWYgd2UgbWVhbiB0aGUgc2FtZSB0aGluZyBieSAnZ29vZCcuLi5cIilcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYodG90YWwgPj0gMzApIHtcbiAgICAgICAgYWxlcnQoXCJTdGVwIHlvdXIgZ2FtZSB1cC4gIE1pZ2h0IEkgcmVjb21tZW5kIHN0YXJ0aW5nIHdpdGggJ0dvb2RmZWxsYXMgb3IgVGhlIERlcGFydGVkPydcIilcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmKHRvdGFsIDwgMzApe1xuICAgICAgICAgIGFsZXJ0KFwiWW91IHByb2JhYmx5IHRhbGsgYW5kIHRleHQgaW4gdGhlYXRlcnMgYW5kIGRlZmluaXRlbHkgZG9udCBkZXNlcnZlIGEgTmV0ZmxpeCBhY2NvdW50LlwiKVxuICAgICAgICAgIH07XG59KTtcblxuLy9hcHBlbmRpbmcgdGFzdGUgdGVzdCByZXN1bHQgdG8gcGFnZVxuZnVuY3Rpb24gYWRkVGFzdGVUZXN0UmVzdWx0KHRvdGFsKXtcbiAgICB2YXIgJHJlbW92ZUJ0biA9ICQoJy5yZW1vdmUnKVxuICAgIHZhciAkdHRSZXN1bHQ9JChcIi5yYXRpbmdcIik7XG4gICAgJHJlbW92ZUJ0bi5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG4gICAgJHR0UmVzdWx0LmFwcGVuZChcIlRhc3RlIFRlc3QgU2NvcmU6IFwiLCB0b3RhbCk7XG4gICAgJHR0UmVzdWx0LnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcblxuICB9XG5cbi8vIC8vdHJ5aW5nIHRvIGdldCB0aGUgdGFzdGUgdGVzdCByZXN1bHQgdG8gaGlkZSBvbiBidXR0b24gY2xpY2tcbiQoJy5yZW1vdmUnKS5vbignY2xpY2snLCBmdW5jdGlvbigpe1xuICAgIHZhciAkdHRSZXN1bHQgPSAkKFwiLnJhdGluZ1wiKTtcbiAgICB2YXIgJHJlbW92ZUJ0biA9ICQoJy5yZW1vdmUnKVxuICAgICRyZW1vdmVCdG4uYWRkQ2xhc3MoJ2hpZGRlbicpO1xuICAgICR0dFJlc3VsdC5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkdHRSZXN1bHQuZW1wdHkoJy5yYXRpbmcnKTtcbiAgfSlcblxuLy9vbiBwYWdlIGxvYWQgaXQgY2hlY2tzIGlmIHlvdSBhcmUgbG9nZ2VkIGluLiAgSWYgeW91IGFyZW50LCBpdCBzZW5kcyB5b3UgdG8gbG9naW4gcGFnZS5cbiQoIGRvY3VtZW50ICkucmVhZHkoZnVuY3Rpb24oKSB7XG5pZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICE9PSAnL2xvZ2luLmh0bWwnICYmICFmYi5nZXRBdXRoKCkpIHtcbiB3aW5kb3cubG9jYXRpb24gPScvbG9naW4uaHRtbCc7XG4gICAgfVxuICB9KTtcblxuLy9zZWFyY2ggYnV0dG9uIHdvcmtpbmcgYW5kIGRvbmVcbiQoJy5zZWFyY2gnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgdmFyIGlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb3ZpZU5hbWVcIik7XG4gIHZhciB0aXRsZSA9IGlucHV0LnZhbHVlO1xuICB2YXIgdXJsID0gaW5mbyArIHRpdGxlO1xuICB2YXIgdWlkID0gZmIuZ2V0QXV0aCgpLnVpZDtcbiAgdmFyIHRva2VuID0gZmIuZ2V0QXV0aCgpLnRva2VuO1xuICB2YXIgcG9zdFVybCA9IGAke0ZJUkVCQVNFX0FVVEh9L3VzZXJzLyR7dWlkfS9mbGlja3MuanNvbj9hdXRoPSR7dG9rZW59YDtcbiAgJC5nZXQodXJsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgIGlmKGRhdGEuUmVzcG9uc2UgPT09IFwiVHJ1ZVwiKXtcbiAgICAkLnBvc3QocG9zdFVybCwgSlNPTi5zdHJpbmdpZnkoZGF0YSksIGZ1bmN0aW9uIChyZXMpIHtcbiAgICBjb25zb2xlLmxvZyhcIlBvc3QgUmVxdWVzdCBQYXNzZWRcIilcbiAgfSk7XG4gICAgYWRkTW92aWVEZXRhaWwoZGF0YSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFsZXJ0KFwiU29ycnkhIEZpbG0gbm90IGZvdW5kISBDaGVjayB0aXRsZSBhbmQgdHJ5IGFnYWluIVwiKVxuICAgIH1cbiAgfSwgJ2pzb25wJyk7XG59KTtcblxuLy9sb2FkcyBkYXRhIHBlciB1c2VyIGFuZCBrZWVwcyBpdHMgcGVyc2lzdGluZ1xuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcbiAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gJy8nICYmIGZiLmdldEF1dGgoKSAhPT0gbnVsbCl7XG4gICAgdmFyIHVpZCA9IGZiLmdldEF1dGgoKS51aWQ7XG4gICAgdmFyIHRva2VuID0gZmIuZ2V0QXV0aCgpLnRva2VuO1xuICAgIHZhciBNb3ZpZUxpc3RVcmwgPSBgJHtGSVJFQkFTRV9BVVRIfS91c2Vycy8ke3VpZH0vZmxpY2tzLmpzb24/YXV0aD0ke3Rva2VufWA7XG4gICAgJC5nZXQoTW92aWVMaXN0VXJsLCBmdW5jdGlvbiAobW92aWVzKSB7XG4gICAgICBPYmplY3Qua2V5cyhtb3ZpZXMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICBhZGRNb3ZpZURldGFpbChtb3ZpZXNbaWRdLCBpZCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxufSk7XG5cblxuZnVuY3Rpb24gYWRkTW92aWVEZXRhaWwoZGF0YSwgaWQpe1xuICB2YXIgJHRhYmxlPSQoXCIudGFibGVcIik7XG4gICAgJHRhYmxlLmFwcGVuZChcIjx0cj48L3RyPlwiKTtcbiAgICB2YXIgJHRhcmdldD0kKFwidHI6bGFzdFwiKTtcbiAgICBzY29yZUFyciA9IHNjb3JlQXJyICsgTWF0aC5yb3VuZChkYXRhLmltZGJSYXRpbmcpICsgXCIgXCI7XG4gICAgICAkdGFyZ2V0LmF0dHIoXCJkYXRhLWlkXCIsIGlkKTtcbiAgICAgICR0YXJnZXQuYXBwZW5kKFwiPHRkPlwiICsgZGF0YS5UaXRsZSArIFwiPC90ZD5cIik7XG4gICAgICAkdGFyZ2V0LmFwcGVuZChcIjx0ZD5cIiArIGRhdGEuaW1kYlJhdGluZyArIFwiPC90ZD5cIik7XG4gICAgICAkdGFyZ2V0LmFwcGVuZChcIjx0ZD5cIiArIGRhdGEuUmVsZWFzZWQgKyBcIjwvdGQ+XCIpO1xuICAgICAgJHRhcmdldC5hcHBlbmQoXCI8dGQ+PGltZyB3aWR0aD0nMjAwJyBoZWlnaHQ9JzI1MCcgc3JjPVwiICsgZGF0YS5Qb3N0ZXIgKyBcIj48L2ltZz48L3RkPlwiKTtcbiAgICAgICR0YXJnZXQuYXBwZW5kKFwiPGJ1dHRvbiBjbGFzcz0nZGVsZXRlJz5EZWxldGU8L2J1dHRvbj5cIik7XG59O1xuXG4vLy9EZWxldGVzIGluZGl2aWR1YWwgdXNlcnMgZGF0YSBmcm9tIGZpcmViYXNlXG52YXIgJGJ1dHRvbiA9ICQoJy50YWJsZScpO1xuJGJ1dHRvbi5vbihcImNsaWNrXCIsIFwiLmRlbGV0ZVwiLCBmdW5jdGlvbigpIHtcbiAgdmFyIHVpZCA9IGZiLmdldEF1dGgoKS51aWQ7XG4gIHZhciB0b2tlbiA9IGZiLmdldEF1dGgoKS50b2tlblxuICB2YXIgJG1vdmllUm93ID0gJCh0aGlzKS5jbG9zZXN0KCd0cicpO1xuICB2YXIgaWQgPSAkbW92aWVSb3cuYXR0cignZGF0YS1pZCcpO1xuICB2YXIgZGVsZXRlVXJsID0gRklSRUJBU0VfQVVUSCArICcvJyArICd1c2VycycgKyAnLycgKyB1aWQgKyAnLycgKyAnZmxpY2tzJyArICcvJyArIGlkICsgJy5qc29uJztcbiAgICAkLmFqYXgoe1xuICAgIHVybDogZGVsZXRlVXJsLFxuICAgIHR5cGU6ICdERUxFVEUnLFxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgJG1vdmllUm93LnJlbW92ZSgpO1xuICAgIH1cbiAgfSlcbn0pO1xuXG4vL2V2ZXJ5dGhpbmcgYmVsb3cgdGhpcyBwb2ludCBpcyBmb3IgbG9naW4uaHRtbFxuXG4vL2xvZ2luIGJ1dHRvblxuJCgnLmxvZ2luUGFnZUZvcm0gZm9ybScpLm9uKCdzdWJtaXQnLCBmdW5jdGlvbiAoZXZ0KSB7XG4gIHZhciBlbWFpbCA9ICQoJy5sb2dpblBhZ2VGb3JtIGlucHV0W3R5cGU9XCJlbWFpbFwiXScpLnZhbCgpO1xuICB2YXIgcGFzc3dvcmQgPSAkKCcubG9naW5QYWdlRm9ybSBpbnB1dFt0eXBlPVwicGFzc3dvcmRcIl0nKS52YWwoKTtcbiAgdmFyIG9uVGVtcFBhc3N3b3JkID0gJCgnLm9uVGVtcFBhc3N3b3JkJyk7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBmYi5hdXRoV2l0aFBhc3N3b3JkKHtcbiAgICBlbWFpbDogZW1haWwsXG4gICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGF1dGhEYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgYWxlcnQoZXJyLnRvU3RyaW5nKCkpO1xuICAgIH0gZWxzZSBpZihhdXRoRGF0YSAmJiBhdXRoRGF0YS5wYXNzd29yZC5pc1RlbXBvcmFyeVBhc3N3b3JkKSB7XG4gICAgICBvblRlbXBQYXNzd29yZC5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG4gICAgICBhbGVydChcIlBsZWFzZSBjaGFuZ2UgeW91ciBwYXNzd29yZCBub3cuXCIpXG4gICAgfSBlbHNlIHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcvJ1xuICAgIH1cbiAgfSk7XG59KTtcblxuLy8gcnVucyB3aGVuIGNhbGxlZCBieSByZWdpc3RyYXRpb24gYnV0dG9uIGlmICBzdWNjZXNzZnVsXG5mdW5jdGlvbiBkb0xvZ2luIChlbWFpbCwgcGFzc3dvcmQsIGNiKSB7XG4gIGZiLmF1dGhXaXRoUGFzc3dvcmQoe1xuICAgIGVtYWlsOiBlbWFpbCxcbiAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgfSwgZnVuY3Rpb24gKGVyciwgYXV0aERhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBhbGVydChlcnIudG9TdHJpbmcoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNhdmVBdXRoRGF0YShhdXRoRGF0YSk7XG4gICAgICB0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicgJiYgY2IoYXV0aERhdGEpO1xuICAgICAgd2luZG93LmxvY2F0aW9uID0gJy8nXG4gICAgICBhbGVydChcIlJlZ2lzdHJhdGlvbiBTdWNjZXNzZnVsIVwiKVxuICAgIH1cbiAgfSk7XG59XG5cbi8vc2F2ZXMgdGhlIGF1dGhlbnRpY2F0aW9uIGRhdGEgdG8gZmlyZWJhc2VcbmZ1bmN0aW9uIHNhdmVBdXRoRGF0YSAoYXV0aERhdGEpIHtcbiAgJC5hamF4KHtcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIHVybDogYCR7RklSRUJBU0VfQVVUSH0vdXNlcnMvJHthdXRoRGF0YS51aWR9L3Byb2ZpbGUuanNvbmAsXG4gICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoYXV0aERhdGEpXG4gIH0pO1xufVxuXG5cbi8vcmVnaXN0ZXIgYnV0dG9uXG4kKCcubG9naW5QYWdlRm9ybSAuZG9SZWdpc3RlcicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGVtYWlsID0gJCgnLmxvZ2luUGFnZUZvcm0gaW5wdXRbdHlwZT1cImVtYWlsXCJdJykudmFsKCk7XG4gIHZhciBwYXNzd29yZCA9ICQoJy5sb2dpblBhZ2VGb3JtIGlucHV0W3R5cGU9XCJwYXNzd29yZFwiXScpLnZhbCgpO1xuXG4gIGZiLmNyZWF0ZVVzZXIoe1xuICAgIGVtYWlsOiBlbWFpbCxcbiAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgfSwgZnVuY3Rpb24gKGVyciwgdXNlckRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBhbGVydChlcnIudG9TdHJpbmcoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvTG9naW4oZW1haWwsIHBhc3N3b3JkKTtcbiAgICB9XG4gIH0pO1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufSk7XG5cbi8vZm9yZ290IHBhc3N3b3JkIGJ1dHRvblxuJCgnLmxvZ2luUGFnZUZvcm0gLmRvUmVzZXRQYXNzd29yZCcpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGVtYWlsID0gJCgnLmxvZ2luUGFnZUZvcm0gaW5wdXRbdHlwZT1cImVtYWlsXCJdJykudmFsKCk7XG5cbiAgZmIucmVzZXRQYXNzd29yZCh7XG4gICAgZW1haWw6IGVtYWlsXG4gIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBhbGVydChlcnIudG9TdHJpbmcoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFsZXJ0KCdDaGVjayB5b3VyIGVtYWlsIScpO1xuICAgIH1cbiAgfSk7XG59KTtcblxuLy9yZXNldCBwYXNzd29yZCBmb3JtXG4kKCcub25UZW1wUGFzc3dvcmQgZm9ybScpLnN1Ym1pdChmdW5jdGlvbiAoKSB7XG4gIHZhciBlbWFpbCA9IGZiLmdldEF1dGgoKS5wYXNzd29yZC5lbWFpbDtcbiAgdmFyIG9sZFB3ID0gJCgnLm9uVGVtcFBhc3N3b3JkIGlucHV0Om50aC1jaGlsZCgxKScpLnZhbCgpO1xuICB2YXIgbmV3UHcgPSAkKCcub25UZW1wUGFzc3dvcmQgaW5wdXQ6bnRoLWNoaWxkKDIpJykudmFsKCk7XG5cbiAgZmIuY2hhbmdlUGFzc3dvcmQoe1xuICAgIGVtYWlsOiBlbWFpbCxcbiAgICBvbGRQYXNzd29yZDogb2xkUHcsXG4gICAgbmV3UGFzc3dvcmQ6IG5ld1B3XG4gIH0sIGZ1bmN0aW9uKGVycikge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGFsZXJ0KGVyci50b1N0cmluZygpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmIudW5hdXRoKCk7XG4gICAgfVxuICB9KTtcblxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufSlcblxuLy9yZXNldCBwYXNzd29yZCBidXR0b25cbiQoJy5vblRlbXBQYXNzd29yZCBmb3JtJykuc3VibWl0KGZ1bmN0aW9uICgpIHtcbiAgdmFyIGVtYWlsID0gZmIuZ2V0QXV0aCgpLnBhc3N3b3JkLmVtYWlsO1xuICB2YXIgb2xkUHcgPSAkKCcub25UZW1wUGFzc3dvcmQgaW5wdXQ6bnRoLWNoaWxkKDEpJykudmFsKCk7XG4gIHZhciBuZXdQdyA9ICQoJy5vblRlbXBQYXNzd29yZCBpbnB1dDpudGgtY2hpbGQoMiknKS52YWwoKTtcblxuICBmYi5jaGFuZ2VQYXNzd29yZCh7XG4gICAgZW1haWw6IGVtYWlsLFxuICAgIG9sZFBhc3N3b3JkOiBvbGRQdyxcbiAgICBuZXdQYXNzd29yZDogbmV3UHdcbiAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgYWxlcnQoZXJyLnRvU3RyaW5nKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmYi51bmF1dGgoKTtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcvJ1xuICAgIH1cbiAgfSk7XG5cbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn0pXG5cbi8vbG9nb3V0IGJ1dHRvblxuJCgnLmxvZ291dCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICBmYi51bmF1dGgoKTtcbiAgd2luZG93LmxvY2F0aW9uID0gJy8nXG59KTtcbiJdfQ==
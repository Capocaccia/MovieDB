"use strict";

var info = "http://www.omdbapi.com/?t=";
var title = $('.movie').val();
var url = info + title;
var FIREBASE_URL = "https://flickpicker.firebaseio.com/flicks.json";
var FIREBASE_AUTH = 'https://flickpicker.firebaseio.com';
var fb = new Firebase(FIREBASE_AUTH);
var scoreArr = [];

//taste test button works.
$('.tasteTest').on('click', function () {
  var scoreTotalArr = scoreArr.split(" ").map(Number);
  var $ttResult = $(".rating");
  var total = scoreTotalArr.reduce(function (prev, curr) {
    return prev + curr;
  });
  if (total >= 45) {
    addTasteTestResult(total);
    $ttResult.append('<img src="http://upload.wikimedia.org/wikipedia/en/thumb/2/2d/Certified_Fresh.svg/150px-Certified_Fresh.svg.png"</img>');
    //alert("Hey, you know good film when you see it!  You should put down your friends opinions about movies now because your opinions are better and have been reaffirmed by me.  Got it?")
  } else if (total >= 40) {
      alert("Alright, you like good movies but have some guilty pleasures.  Its ok.  I like Mean Girls too.");
    } else if (total >= 35) {
      alert("Sometimes I wonder if we mean the same thing by 'good'...");
    } else if (total >= 30) {
      alert("Step your game up.  Might I recommend starting with 'Goodfellas or The Departed?'");
    } else if (total < 30) {
      alert("You probably talk and text in theaters and definitely dont deserve a Netflix account.");
    };
});

//appending taste test result to page
function addTasteTestResult(total) {
  var $removeBtn = $('.remove');
  var $ttResult = $(".rating");
  $removeBtn.removeClass('hidden');
  $ttResult.append("Taste Test Score: ", total);
  $ttResult.removeClass('hidden');
}

// //trying to get the taste test result to hide on button click
$('.remove').on('click', function () {
  var $ttResult = $(".rating");
  var $removeBtn = $('.remove');
  $removeBtn.addClass('hidden');
  $ttResult.addClass("hidden");
  $ttResult.empty('.rating');
});

//on page load it checks if you are logged in.  If you arent, it sends you to login page.
$(document).ready(function () {
  if (!/login\.html/.test(window.location.pathname) && !fb.getAuth()) {
    window.location = 'login.html';
  }
});

//search button working and done
$('.search').on('click', function () {
  var input = document.querySelector("#movieName");
  var title = input.value;
  var url = info + title;
  var uid = fb.getAuth().uid;
  var token = fb.getAuth().token;
  var postUrl = FIREBASE_AUTH + "/users/" + uid + "/flicks.json?auth=" + token;
  $.get(url, function (data) {
    console.log(data);
    if (data.Response === "True") {
      $.post(postUrl, JSON.stringify(data), function (res) {
        console.log("Post Request Passed");
      });
      addMovieDetail(data);
    } else {
      alert("Sorry! Film not found! Check title and try again!");
    }
  }, 'jsonp');
});

//loads data per user and keeps its persisting
$(document).ready(function () {
  if (!/login\.html/.test(window.location.pathname) && fb.getAuth() !== null) {
    var uid = fb.getAuth().uid;
    var token = fb.getAuth().token;
    var MovieListUrl = FIREBASE_AUTH + "/users/" + uid + "/flicks.json?auth=" + token;
    $.get(MovieListUrl, function (movies) {
      Object.keys(movies).forEach(function (id) {
        addMovieDetail(movies[id], id);
      });
    });
  }
});

function addMovieDetail(data, id) {
  var $table = $(".table");
  $table.append("<tr></tr>");
  var $target = $("tr:last");
  scoreArr = scoreArr + Math.round(data.imdbRating) + " ";
  $target.attr("data-id", id);
  $target.append("<td>" + data.Title + "</td>");
  $target.append("<td>" + data.imdbRating + "</td>");
  $target.append("<td>" + data.Released + "</td>");
  $target.append("<td><img width='200' height='250' src=" + data.Poster + "></img></td>");
  $target.append("<button class='delete'>Delete</button>");
};

///Deletes individual users data from firebase
var $button = $('.table');
$button.on("click", ".delete", function () {
  var uid = fb.getAuth().uid;
  var token = fb.getAuth().token;
  var $movieRow = $(this).closest('tr');
  var id = $movieRow.attr('data-id');
  var deleteUrl = FIREBASE_AUTH + '/' + 'users' + '/' + uid + '/' + 'flicks' + '/' + id + '.json';
  $.ajax({
    url: deleteUrl,
    type: 'DELETE',
    success: function success() {
      $movieRow.remove();
    }
  });
});

//everything below this point is for login.html

//login button
$('.loginPageForm form').on('submit', function (evt) {
  var email = $('.loginPageForm input[type="email"]').val();
  var password = $('.loginPageForm input[type="password"]').val();
  var onTempPassword = $('.onTempPassword');
  evt.preventDefault();
  fb.authWithPassword({
    email: email,
    password: password
  }, function (err, authData) {
    if (err) {
      alert(err.toString());
    } else if (authData && authData.password.isTemporaryPassword) {
      onTempPassword.removeClass('hidden');
      alert("Please change your password now.");
    } else {
      window.location = 'index.html';
    }
  });
});

// runs when called by registration button if  successful
function doLogin(email, password, cb) {
  fb.authWithPassword({
    email: email,
    password: password
  }, function (err, authData) {
    if (err) {
      alert(err.toString());
    } else {
      saveAuthData(authData);
      typeof cb === 'function' && cb(authData);
      window.location = 'index.html';
      alert("Registration Successful!");
    }
  });
}

//saves the authentication data to firebase
function saveAuthData(authData) {
  $.ajax({
    method: 'PUT',
    url: FIREBASE_AUTH + "/users/" + authData.uid + "/profile.json",
    data: JSON.stringify(authData)
  });
}

//register button
$('.loginPageForm .doRegister').click(function () {
  var email = $('.loginPageForm input[type="email"]').val();
  var password = $('.loginPageForm input[type="password"]').val();

  fb.createUser({
    email: email,
    password: password
  }, function (err, userData) {
    if (err) {
      alert(err.toString());
    } else {
      doLogin(email, password);
    }
  });
  event.preventDefault();
});

//forgot password button
$('.loginPageForm .doResetPassword').click(function () {
  var email = $('.loginPageForm input[type="email"]').val();

  fb.resetPassword({
    email: email
  }, function (err) {
    if (err) {
      alert(err.toString());
    } else {
      alert('Check your email!');
    }
  });
});

//reset password form
$('.onTempPassword form').submit(function () {
  var email = fb.getAuth().password.email;
  var oldPw = $('.onTempPassword input:nth-child(1)').val();
  var newPw = $('.onTempPassword input:nth-child(2)').val();

  fb.changePassword({
    email: email,
    oldPassword: oldPw,
    newPassword: newPw
  }, function (err) {
    if (err) {
      alert(err.toString());
    } else {
      fb.unauth();
    }
  });

  event.preventDefault();
});

//reset password button
$('.onTempPassword form').submit(function () {
  var email = fb.getAuth().password.email;
  var oldPw = $('.onTempPassword input:nth-child(1)').val();
  var newPw = $('.onTempPassword input:nth-child(2)').val();

  fb.changePassword({
    email: email,
    oldPassword: oldPw,
    newPassword: newPw
  }, function (err) {
    if (err) {
      alert(err.toString());
    } else {
      fb.unauth();
      window.location = 'index.html';
    }
  });

  event.preventDefault();
});

//logout button
$('.logout').on('click', function () {
  fb.unauth();
  window.location = 'index.html';
});
//# sourceMappingURL=data:application/json;base64,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QUFvQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7O0FBRTFELElBQUUsQ0FBQyxjQUFjLENBQUM7QUFDaEIsU0FBSyxFQUFFLEtBQUs7QUFDWixlQUFXLEVBQUUsS0FBSztBQUNsQixlQUFXLEVBQUUsS0FBSztHQUNuQixFQUFFLFVBQVMsR0FBRyxFQUFFO0FBQ2YsUUFBSSxHQUFHLEVBQUU7QUFDUCxXQUFLLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7S0FDdkIsTUFBTTtBQUNMLFFBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNaLFlBQU0sQ0FBQyxRQUFRLEdBQUcsWUFBWSxDQUFBO0tBQy9CO0dBQ0YsQ0FBQyxDQUFDOztBQUVILE9BQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztDQUN4QixDQUFDLENBQUE7OztBQUdGLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLFlBQVc7QUFDbEMsSUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ1osUUFBTSxDQUFDLFFBQVEsR0FBRyxZQUFZLENBQUE7Q0FDL0IsQ0FBQyxDQUFDIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaW5mbyA9IFwiaHR0cDovL3d3dy5vbWRiYXBpLmNvbS8/dD1cIjtcbnZhciB0aXRsZSA9ICQoJy5tb3ZpZScpLnZhbCgpO1xudmFyIHVybCA9IGluZm8gKyB0aXRsZTtcbnZhciBGSVJFQkFTRV9VUkwgPSBcImh0dHBzOi8vZmxpY2twaWNrZXIuZmlyZWJhc2Vpby5jb20vZmxpY2tzLmpzb25cIlxudmFyIEZJUkVCQVNFX0FVVEggPSAnaHR0cHM6Ly9mbGlja3BpY2tlci5maXJlYmFzZWlvLmNvbSc7XG52YXIgZmIgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VfQVVUSCk7XG52YXIgc2NvcmVBcnIgPSBbXTtcblxuXG4vL3Rhc3RlIHRlc3QgYnV0dG9uIHdvcmtzLlxuJCgnLnRhc3RlVGVzdCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XG4gIHZhciBzY29yZVRvdGFsQXJyID0gc2NvcmVBcnIuc3BsaXQoXCIgXCIpLm1hcChOdW1iZXIpO1xuICB2YXIgJHR0UmVzdWx0PSQoXCIucmF0aW5nXCIpO1xuICB2YXIgdG90YWwgPSBzY29yZVRvdGFsQXJyLnJlZHVjZShmdW5jdGlvbihwcmV2LCBjdXJyKSB7XG4gIHJldHVybiBwcmV2ICsgY3Vycjtcbn0pO1xuaWYgKHRvdGFsID49IDQ1KSB7XG4gIGFkZFRhc3RlVGVzdFJlc3VsdCh0b3RhbCk7XG4gICR0dFJlc3VsdC5hcHBlbmQoJzxpbWcgc3JjPVwiaHR0cDovL3VwbG9hZC53aWtpbWVkaWEub3JnL3dpa2lwZWRpYS9lbi90aHVtYi8yLzJkL0NlcnRpZmllZF9GcmVzaC5zdmcvMTUwcHgtQ2VydGlmaWVkX0ZyZXNoLnN2Zy5wbmdcIjwvaW1nPicpXG4gICAgLy9hbGVydChcIkhleSwgeW91IGtub3cgZ29vZCBmaWxtIHdoZW4geW91IHNlZSBpdCEgIFlvdSBzaG91bGQgcHV0IGRvd24geW91ciBmcmllbmRzIG9waW5pb25zIGFib3V0IG1vdmllcyBub3cgYmVjYXVzZSB5b3VyIG9waW5pb25zIGFyZSBiZXR0ZXIgYW5kIGhhdmUgYmVlbiByZWFmZmlybWVkIGJ5IG1lLiAgR290IGl0P1wiKVxuICB9IGVsc2UgaWYgKHRvdGFsID49IDQwKSB7XG4gICAgYWxlcnQoXCJBbHJpZ2h0LCB5b3UgbGlrZSBnb29kIG1vdmllcyBidXQgaGF2ZSBzb21lIGd1aWx0eSBwbGVhc3VyZXMuICBJdHMgb2suICBJIGxpa2UgTWVhbiBHaXJscyB0b28uXCIpXG4gICAgfVxuICAgIGVsc2UgaWYgKHRvdGFsID49IDM1KSB7XG4gICAgICBhbGVydChcIlNvbWV0aW1lcyBJIHdvbmRlciBpZiB3ZSBtZWFuIHRoZSBzYW1lIHRoaW5nIGJ5ICdnb29kJy4uLlwiKVxuICAgICAgfVxuICAgICAgZWxzZSBpZih0b3RhbCA+PSAzMCkge1xuICAgICAgICBhbGVydChcIlN0ZXAgeW91ciBnYW1lIHVwLiAgTWlnaHQgSSByZWNvbW1lbmQgc3RhcnRpbmcgd2l0aCAnR29vZGZlbGxhcyBvciBUaGUgRGVwYXJ0ZWQ/J1wiKVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYodG90YWwgPCAzMCl7XG4gICAgICAgICAgYWxlcnQoXCJZb3UgcHJvYmFibHkgdGFsayBhbmQgdGV4dCBpbiB0aGVhdGVycyBhbmQgZGVmaW5pdGVseSBkb250IGRlc2VydmUgYSBOZXRmbGl4IGFjY291bnQuXCIpXG4gICAgICAgICAgfTtcbn0pO1xuXG4vL2FwcGVuZGluZyB0YXN0ZSB0ZXN0IHJlc3VsdCB0byBwYWdlXG5mdW5jdGlvbiBhZGRUYXN0ZVRlc3RSZXN1bHQodG90YWwpe1xuICAgIHZhciAkcmVtb3ZlQnRuID0gJCgnLnJlbW92ZScpXG4gICAgdmFyICR0dFJlc3VsdD0kKFwiLnJhdGluZ1wiKTtcbiAgICAkcmVtb3ZlQnRuLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcbiAgICAkdHRSZXN1bHQuYXBwZW5kKFwiVGFzdGUgVGVzdCBTY29yZTogXCIsIHRvdGFsKTtcbiAgICAkdHRSZXN1bHQucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuXG4gIH1cblxuLy8gLy90cnlpbmcgdG8gZ2V0IHRoZSB0YXN0ZSB0ZXN0IHJlc3VsdCB0byBoaWRlIG9uIGJ1dHRvbiBjbGlja1xuJCgnLnJlbW92ZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XG4gICAgdmFyICR0dFJlc3VsdCA9ICQoXCIucmF0aW5nXCIpO1xuICAgIHZhciAkcmVtb3ZlQnRuID0gJCgnLnJlbW92ZScpXG4gICAgJHJlbW92ZUJ0bi5hZGRDbGFzcygnaGlkZGVuJyk7XG4gICAgJHR0UmVzdWx0LmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICR0dFJlc3VsdC5lbXB0eSgnLnJhdGluZycpO1xuICB9KVxuXG4vL29uIHBhZ2UgbG9hZCBpdCBjaGVja3MgaWYgeW91IGFyZSBsb2dnZWQgaW4uICBJZiB5b3UgYXJlbnQsIGl0IHNlbmRzIHlvdSB0byBsb2dpbiBwYWdlLlxuJCggZG9jdW1lbnQgKS5yZWFkeShmdW5jdGlvbigpIHtcbmlmICghKC9sb2dpblxcLmh0bWwvLnRlc3Qod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lKSkgJiYgIWZiLmdldEF1dGgoKSkge1xuIHdpbmRvdy5sb2NhdGlvbiA9J2xvZ2luLmh0bWwnO1xuICAgIH1cbiAgfSk7XG5cbi8vc2VhcmNoIGJ1dHRvbiB3b3JraW5nIGFuZCBkb25lXG4kKCcuc2VhcmNoJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gIHZhciBpbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW92aWVOYW1lXCIpO1xuICB2YXIgdGl0bGUgPSBpbnB1dC52YWx1ZTtcbiAgdmFyIHVybCA9IGluZm8gKyB0aXRsZTtcbiAgdmFyIHVpZCA9IGZiLmdldEF1dGgoKS51aWQ7XG4gIHZhciB0b2tlbiA9IGZiLmdldEF1dGgoKS50b2tlbjtcbiAgdmFyIHBvc3RVcmwgPSBgJHtGSVJFQkFTRV9BVVRIfS91c2Vycy8ke3VpZH0vZmxpY2tzLmpzb24/YXV0aD0ke3Rva2VufWA7XG4gICQuZ2V0KHVybCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICBpZihkYXRhLlJlc3BvbnNlID09PSBcIlRydWVcIil7XG4gICAgJC5wb3N0KHBvc3RVcmwsIEpTT04uc3RyaW5naWZ5KGRhdGEpLCBmdW5jdGlvbiAocmVzKSB7XG4gICAgY29uc29sZS5sb2coXCJQb3N0IFJlcXVlc3QgUGFzc2VkXCIpXG4gIH0pO1xuICAgIGFkZE1vdmllRGV0YWlsKGRhdGEpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhbGVydChcIlNvcnJ5ISBGaWxtIG5vdCBmb3VuZCEgQ2hlY2sgdGl0bGUgYW5kIHRyeSBhZ2FpbiFcIilcbiAgICB9XG4gIH0sICdqc29ucCcpO1xufSk7XG5cbi8vbG9hZHMgZGF0YSBwZXIgdXNlciBhbmQga2VlcHMgaXRzIHBlcnNpc3RpbmdcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XG4gIGlmICghKC9sb2dpblxcLmh0bWwvLnRlc3Qod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lKSkgJiYgZmIuZ2V0QXV0aCgpICE9PSBudWxsKXtcbiAgICB2YXIgdWlkID0gZmIuZ2V0QXV0aCgpLnVpZDtcbiAgICB2YXIgdG9rZW4gPSBmYi5nZXRBdXRoKCkudG9rZW47XG4gICAgdmFyIE1vdmllTGlzdFVybCA9IGAke0ZJUkVCQVNFX0FVVEh9L3VzZXJzLyR7dWlkfS9mbGlja3MuanNvbj9hdXRoPSR7dG9rZW59YDtcbiAgICAkLmdldChNb3ZpZUxpc3RVcmwsIGZ1bmN0aW9uIChtb3ZpZXMpIHtcbiAgICAgIE9iamVjdC5rZXlzKG1vdmllcykuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgIGFkZE1vdmllRGV0YWlsKG1vdmllc1tpZF0sIGlkKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59KTtcblxuXG5mdW5jdGlvbiBhZGRNb3ZpZURldGFpbChkYXRhLCBpZCl7XG4gIHZhciAkdGFibGU9JChcIi50YWJsZVwiKTtcbiAgICAkdGFibGUuYXBwZW5kKFwiPHRyPjwvdHI+XCIpO1xuICAgIHZhciAkdGFyZ2V0PSQoXCJ0cjpsYXN0XCIpO1xuICAgIHNjb3JlQXJyID0gc2NvcmVBcnIgKyBNYXRoLnJvdW5kKGRhdGEuaW1kYlJhdGluZykgKyBcIiBcIjtcbiAgICAgICR0YXJnZXQuYXR0cihcImRhdGEtaWRcIiwgaWQpO1xuICAgICAgJHRhcmdldC5hcHBlbmQoXCI8dGQ+XCIgKyBkYXRhLlRpdGxlICsgXCI8L3RkPlwiKTtcbiAgICAgICR0YXJnZXQuYXBwZW5kKFwiPHRkPlwiICsgZGF0YS5pbWRiUmF0aW5nICsgXCI8L3RkPlwiKTtcbiAgICAgICR0YXJnZXQuYXBwZW5kKFwiPHRkPlwiICsgZGF0YS5SZWxlYXNlZCArIFwiPC90ZD5cIik7XG4gICAgICAkdGFyZ2V0LmFwcGVuZChcIjx0ZD48aW1nIHdpZHRoPScyMDAnIGhlaWdodD0nMjUwJyBzcmM9XCIgKyBkYXRhLlBvc3RlciArIFwiPjwvaW1nPjwvdGQ+XCIpO1xuICAgICAgJHRhcmdldC5hcHBlbmQoXCI8YnV0dG9uIGNsYXNzPSdkZWxldGUnPkRlbGV0ZTwvYnV0dG9uPlwiKTtcbn07XG5cbi8vL0RlbGV0ZXMgaW5kaXZpZHVhbCB1c2VycyBkYXRhIGZyb20gZmlyZWJhc2VcbnZhciAkYnV0dG9uID0gJCgnLnRhYmxlJyk7XG4kYnV0dG9uLm9uKFwiY2xpY2tcIiwgXCIuZGVsZXRlXCIsIGZ1bmN0aW9uKCkge1xuICB2YXIgdWlkID0gZmIuZ2V0QXV0aCgpLnVpZDtcbiAgdmFyIHRva2VuID0gZmIuZ2V0QXV0aCgpLnRva2VuXG4gIHZhciAkbW92aWVSb3cgPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJyk7XG4gIHZhciBpZCA9ICRtb3ZpZVJvdy5hdHRyKCdkYXRhLWlkJyk7XG4gIHZhciBkZWxldGVVcmwgPSBGSVJFQkFTRV9BVVRIICsgJy8nICsgJ3VzZXJzJyArICcvJyArIHVpZCArICcvJyArICdmbGlja3MnICsgJy8nICsgaWQgKyAnLmpzb24nO1xuICAgICQuYWpheCh7XG4gICAgdXJsOiBkZWxldGVVcmwsXG4gICAgdHlwZTogJ0RFTEVURScsXG4gICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAkbW92aWVSb3cucmVtb3ZlKCk7XG4gICAgfVxuICB9KVxufSk7XG5cbi8vZXZlcnl0aGluZyBiZWxvdyB0aGlzIHBvaW50IGlzIGZvciBsb2dpbi5odG1sXG5cbi8vbG9naW4gYnV0dG9uXG4kKCcubG9naW5QYWdlRm9ybSBmb3JtJykub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uIChldnQpIHtcbiAgdmFyIGVtYWlsID0gJCgnLmxvZ2luUGFnZUZvcm0gaW5wdXRbdHlwZT1cImVtYWlsXCJdJykudmFsKCk7XG4gIHZhciBwYXNzd29yZCA9ICQoJy5sb2dpblBhZ2VGb3JtIGlucHV0W3R5cGU9XCJwYXNzd29yZFwiXScpLnZhbCgpO1xuICB2YXIgb25UZW1wUGFzc3dvcmQgPSAkKCcub25UZW1wUGFzc3dvcmQnKTtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGZiLmF1dGhXaXRoUGFzc3dvcmQoe1xuICAgIGVtYWlsOiBlbWFpbCxcbiAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgfSwgZnVuY3Rpb24gKGVyciwgYXV0aERhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBhbGVydChlcnIudG9TdHJpbmcoKSk7XG4gICAgfSBlbHNlIGlmKGF1dGhEYXRhICYmIGF1dGhEYXRhLnBhc3N3b3JkLmlzVGVtcG9yYXJ5UGFzc3dvcmQpIHtcbiAgICAgIG9uVGVtcFBhc3N3b3JkLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcbiAgICAgIGFsZXJ0KFwiUGxlYXNlIGNoYW5nZSB5b3VyIHBhc3N3b3JkIG5vdy5cIilcbiAgICB9IGVsc2Uge1xuICAgICAgd2luZG93LmxvY2F0aW9uID0gJ2luZGV4Lmh0bWwnXG4gICAgfVxuICB9KTtcbn0pO1xuXG4vLyBydW5zIHdoZW4gY2FsbGVkIGJ5IHJlZ2lzdHJhdGlvbiBidXR0b24gaWYgIHN1Y2Nlc3NmdWxcbmZ1bmN0aW9uIGRvTG9naW4gKGVtYWlsLCBwYXNzd29yZCwgY2IpIHtcbiAgZmIuYXV0aFdpdGhQYXNzd29yZCh7XG4gICAgZW1haWw6IGVtYWlsLFxuICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICB9LCBmdW5jdGlvbiAoZXJyLCBhdXRoRGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGFsZXJ0KGVyci50b1N0cmluZygpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2F2ZUF1dGhEYXRhKGF1dGhEYXRhKTtcbiAgICAgIHR5cGVvZiBjYiA9PT0gJ2Z1bmN0aW9uJyAmJiBjYihhdXRoRGF0YSk7XG4gICAgICB3aW5kb3cubG9jYXRpb24gPSAnaW5kZXguaHRtbCdcbiAgICAgIGFsZXJ0KFwiUmVnaXN0cmF0aW9uIFN1Y2Nlc3NmdWwhXCIpXG4gICAgfVxuICB9KTtcbn1cblxuLy9zYXZlcyB0aGUgYXV0aGVudGljYXRpb24gZGF0YSB0byBmaXJlYmFzZVxuZnVuY3Rpb24gc2F2ZUF1dGhEYXRhIChhdXRoRGF0YSkge1xuICAkLmFqYXgoe1xuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgdXJsOiBgJHtGSVJFQkFTRV9BVVRIfS91c2Vycy8ke2F1dGhEYXRhLnVpZH0vcHJvZmlsZS5qc29uYCxcbiAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShhdXRoRGF0YSlcbiAgfSk7XG59XG5cblxuLy9yZWdpc3RlciBidXR0b25cbiQoJy5sb2dpblBhZ2VGb3JtIC5kb1JlZ2lzdGVyJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICB2YXIgZW1haWwgPSAkKCcubG9naW5QYWdlRm9ybSBpbnB1dFt0eXBlPVwiZW1haWxcIl0nKS52YWwoKTtcbiAgdmFyIHBhc3N3b3JkID0gJCgnLmxvZ2luUGFnZUZvcm0gaW5wdXRbdHlwZT1cInBhc3N3b3JkXCJdJykudmFsKCk7XG5cbiAgZmIuY3JlYXRlVXNlcih7XG4gICAgZW1haWw6IGVtYWlsLFxuICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICB9LCBmdW5jdGlvbiAoZXJyLCB1c2VyRGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGFsZXJ0KGVyci50b1N0cmluZygpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZG9Mb2dpbihlbWFpbCwgcGFzc3dvcmQpO1xuICAgIH1cbiAgfSk7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59KTtcblxuLy9mb3Jnb3QgcGFzc3dvcmQgYnV0dG9uXG4kKCcubG9naW5QYWdlRm9ybSAuZG9SZXNldFBhc3N3b3JkJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICB2YXIgZW1haWwgPSAkKCcubG9naW5QYWdlRm9ybSBpbnB1dFt0eXBlPVwiZW1haWxcIl0nKS52YWwoKTtcblxuICBmYi5yZXNldFBhc3N3b3JkKHtcbiAgICBlbWFpbDogZW1haWxcbiAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGFsZXJ0KGVyci50b1N0cmluZygpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYWxlcnQoJ0NoZWNrIHlvdXIgZW1haWwhJyk7XG4gICAgfVxuICB9KTtcbn0pO1xuXG4vL3Jlc2V0IHBhc3N3b3JkIGZvcm1cbiQoJy5vblRlbXBQYXNzd29yZCBmb3JtJykuc3VibWl0KGZ1bmN0aW9uICgpIHtcbiAgdmFyIGVtYWlsID0gZmIuZ2V0QXV0aCgpLnBhc3N3b3JkLmVtYWlsO1xuICB2YXIgb2xkUHcgPSAkKCcub25UZW1wUGFzc3dvcmQgaW5wdXQ6bnRoLWNoaWxkKDEpJykudmFsKCk7XG4gIHZhciBuZXdQdyA9ICQoJy5vblRlbXBQYXNzd29yZCBpbnB1dDpudGgtY2hpbGQoMiknKS52YWwoKTtcblxuICBmYi5jaGFuZ2VQYXNzd29yZCh7XG4gICAgZW1haWw6IGVtYWlsLFxuICAgIG9sZFBhc3N3b3JkOiBvbGRQdyxcbiAgICBuZXdQYXNzd29yZDogbmV3UHdcbiAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgYWxlcnQoZXJyLnRvU3RyaW5nKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmYi51bmF1dGgoKTtcbiAgICB9XG4gIH0pO1xuXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59KVxuXG4vL3Jlc2V0IHBhc3N3b3JkIGJ1dHRvblxuJCgnLm9uVGVtcFBhc3N3b3JkIGZvcm0nKS5zdWJtaXQoZnVuY3Rpb24gKCkge1xuICB2YXIgZW1haWwgPSBmYi5nZXRBdXRoKCkucGFzc3dvcmQuZW1haWw7XG4gIHZhciBvbGRQdyA9ICQoJy5vblRlbXBQYXNzd29yZCBpbnB1dDpudGgtY2hpbGQoMSknKS52YWwoKTtcbiAgdmFyIG5ld1B3ID0gJCgnLm9uVGVtcFBhc3N3b3JkIGlucHV0Om50aC1jaGlsZCgyKScpLnZhbCgpO1xuXG4gIGZiLmNoYW5nZVBhc3N3b3JkKHtcbiAgICBlbWFpbDogZW1haWwsXG4gICAgb2xkUGFzc3dvcmQ6IG9sZFB3LFxuICAgIG5ld1Bhc3N3b3JkOiBuZXdQd1xuICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBhbGVydChlcnIudG9TdHJpbmcoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZiLnVuYXV0aCgpO1xuICAgICAgd2luZG93LmxvY2F0aW9uID0gJ2luZGV4Lmh0bWwnXG4gICAgfVxuICB9KTtcblxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufSlcblxuLy9sb2dvdXQgYnV0dG9uXG4kKCcubG9nb3V0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gIGZiLnVuYXV0aCgpO1xuICB3aW5kb3cubG9jYXRpb24gPSAnaW5kZXguaHRtbCdcbn0pO1xuIl19